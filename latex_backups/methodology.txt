\addcontentsline{toc}{chapter}{Methodology}
\chapter*{\hfill Methodology}
\addcontentsline{toc}{section}{Data Collection}
\section*{\large{Data Collection}}
\begin{enumerate}
    \item \textbf{Data Source}: The historical data of 10 years for this dissertation was collected using the Yahoo Finance API(\href{https://python-yahoofinance.readthedocs.io/en/latest/api.html}{yfinance}), specifically version 0.2.18. This API allowed for the retrieval of financial data relevant to the dissertation objectives.
    \item \textbf{Code Language}: The coding language employed throughout the study is Python (version 3.8). Python provided a robust and versatile platform for conducting the research and data analysis.
    \item \textbf{Data Analysis and Statistical measurements}: For statistical analysis, \href{https://numpy.org/doc/}{Numpy}(version 1.20.3) and \href{https://pandas.pydata.org/docs/}{Pandas}(version 1.5.3) were used. These libraries offered comprehensive functionalities for data manipulation and statistical computations.
    \item \textbf{Exploratory Data Analysis(EDA)}: \href{https://plotly.com/python/}{Plotly}(version 5.13.0) and Tableau\footnote{The student version of Tableau software was utilized, and access to this version was obtained by verifying and substantiating my student status as required by the provider.} were extensively used to generate plots and visualisations. 
    \item \textbf{Optimisation}: Scipy's \href{https://docs.scipy.org/doc/scipy/reference/optimize.html}{optimisation}\footnote{The \href{SLSPQ}{SLSPQ} algorithm, provided within the optimization function of the Scipy library, was employed in this study.}(version 1.5.4),  was used to conduct the convex optimisation for the baseline mean-variance model. 
    \item \textbf{Machine Learning}: For the deployment of ML algorithms, the study will utilise \href{https://scikit-learn.org/stable/}{Scikit-learn} library(version 0.23.2). Scikit-learn is widely used by ML practitioners as it provides a comprehensive set of tools for training, evaluating, and deploying ML models.
\end{enumerate}
These tools and libraries were carefully selected based on their suitability, reliability, and compatibility with the research objectives and methodologies. Their usage adhered to the terms and conditions of their respective licenses and complied with relevant legal and ethical guidelines.
\newpage
\addcontentsline{toc}{section}{Stock selection}
\section*{\large{Stock Selection}}
Here is the overall schematic of the initial stock selection process:
\begin{figure}[h]
\centering
\begin{tikzpicture}[scale=0.7, every node/.style={scale=0.7}, node distance=2cm]
\usetikzlibrary{shapes.geometric, arrows}
\node (start) [rectangle, rounded corners, text centered, draw=black] {Start};
\node (selectindex) [rectangle, text centered, draw=black, below of=start] {Select the Market Index};
\node (selectstocks) [rectangle, text centered, draw=black, below of=selectindex] {Select the Pool of Stocks};
\node (calculateKPI) [rectangle, text centered, draw=black, below of=selectstocks] {Calculate KPI};
\node (decision) [diamond, aspect=2, text centered, draw=black, below of=calculateKPI] {KPI $>$ Threshold?};
\node (feedmodel) [rectangle, text centered, draw=black, below of=decision, yshift=-1cm] {Feed Model to Optimizer};
\node (results) [rectangle, rounded corners, text centered, draw=black, below of=feedmodel] {Generate Optimal Weights and Calculate Returns};

\draw [->] (start) -- (selectindex);
\draw [->] (selectindex) -- (selectstocks);
\draw [->] (selectstocks) -- (calculateKPI);
\draw [->] (calculateKPI) -- (decision);
\draw [->] (decision) -- node [midway, right] {Yes} (feedmodel);
\draw [->] (feedmodel) -- (results);
\draw [->] (decision) -| node [midway, above] {No} ++(-3cm,0) |- (selectstocks);
\end{tikzpicture}
\caption{The initial stock selection process.}
\end{figure} 
\newline
The dissertation's data is acquired from \href{https://www.nseindia.com/}{National Stock Exchange(NSE)}, an Indian stock exchange. The National Stock Exchange is one of the distinguished stock exchanges in India and plays a crucial role in the Indian financial market. Established in 1992, the NSE has emerged as a leading platform for trading several financial instruments, including derivatives, equities, currencies, debt securities, etc. As of 19th June 2023, NSE had over 1,600 actively traded stocks listed on its platform. These stocks represent various sectors and industries, providing investors with myriad investment opportunities. We will be using \href{https://www.nseindia.com/market-data/live-equity-market}{NIFTY 50} for our study. \\\\
This study employs the usage of \href{https://algotrading101.com/learn/yahoo-finance-api-guide/}{Yahoo Finance API} to gather the data from the NIFTY 50 index. The historical data of 10 years is fed into Markowitz's mean-variance model. The historical returns are used to rank the stocks based on the weighted average of Sharpe (\cite{sharpe1964capital}) and Sortino (\cite{sortino1994downside}) ratios, with more weight assigned to the former. The KPI used to evaluate stock performance:
\begin{align}
    \label{eq:KPI}
    \text{KPI} = 0.7\times \text{Sharpe Ratio} + 0.3\times \text{Sortino Ratio}
\end{align}
The study utilises the KPI for the initial stock selection process.
\addcontentsline{toc}{section}{Key findings and figures}
\section*{\large{Key findings and figures}}
Let $S_i$ and $r_{i}$ be the stock price and its return at time period $i$ respectively. Let $R$ be the total return on the stock and $T$ be the time horizon. The cumulative return is given by
\begin{align}
    \label{eq:cumulative_return}
    R = \prod_{i=1}^T (1 + r_i)
\end{align}
For this dissertation, percentage return is used.
\begin{align}
    \label{eq:percentage_return}
    r = \frac{p_t - p_{t-1}}{p_{t-1}}
\end{align}
where, \\
$p_t$: Stock price in the current period \\
$p_{t-1}$: Previous stock price \\\\
Presented below are the top 10 stocks, determined by the KPI, for the NIFTY 50 index, using historical data spanning a period of 10 years.
\begin{figure}[t]
    \centering
    \includegraphics[width=1\textwidth]{Methodology/wealth_growth.jpg}
    \caption{Cumulative returns in the span of 10 years.}
    \label{fig:image}
\end{figure}
\begin{table}[h]
    \centering
    \begin{tabular}{|l|r|r|r|}
    \hline
    \textbf{Ticker} & \textbf{Sharpe Ratio} & \textbf{Sortino Ratio} & \textbf{KPI} \\
    \hline
    ADANIENT.NS & 1.248062 & 2.111403 & 1.507065 \\
    APOLLOHOSP.NS & 0.791097 & 1.439578 & 0.985642 \\
    NESTLEIND.NS & 0.732972 & 1.339456 & 0.914917 \\
    TITAN.NS & 0.734486 & 1.220673 & 0.880342 \\
    DIVISLAB.NS & 0.696405 & 1.170755 & 0.838710 \\
    TATASTEEL.NS & 0.560782 & 1.389459 & 0.809385 \\
    BAJFINANCE.NS & 0.684331 & 1.093758 & 0.807159 \\
    TATACONSUM.NS & 0.652877 & 1.120283 & 0.793099 \\
    HCLTECH.NS & 0.623058 & 1.045049 & 0.749655 \\
    INFY.NS & 0.628178 & 1.010191 & 0.742782 \\
    \hline
    \end{tabular}
    \caption{Top 10 stocks based on KPI}
    \label{tab:top_10_stocks}
\end{table}
\newpage
\begin{table}[h]
    \centering
    \small
    \begin{tabular}{|l|r|r|r|r|r|r|r|r|}
    \hline
    \textbf{Stock} & \textbf{count} & \textbf{mean} & \textbf{std} & \textbf{min} & \textbf{25\%} & \textbf{50\%} & \textbf{75\%} & \textbf{max} \\
    \hline
    \textbf{ADANIENT.NS} & 1382.0 & 0.003056 & 0.035370 & -0.281970 & -0.011983 & 0.002250 & 0.016445 & 0.273680 \\
    \textbf{APOLLOHOSP.NS} & 1382.0 & 0.001417 & 0.022977 & -0.149895 & -0.010918 & 0.000113 & 0.011797 & 0.154945 \\
    \textbf{NESTLEIND.NS} & 1382.0 & 0.000967 & 0.014899 & -0.084893 & -0.007482 & 0.000274 & 0.008327 & 0.128040 \\
    \textbf{TITAN.NS} & 1382.0 & 0.001167 & 0.019244 & -0.122560 & -0.008443 & 0.001160 & 0.010429 & 0.109913 \\
    \textbf{DIVISLAB.NS} & 1382.0 & 0.001107 & 0.019289 & -0.117126 & -0.008834 & 0.000952 & 0.011428 & 0.146799 \\
    \textbf{TATASTEEL.NS} & 1382.0 & 0.001564 & 0.036514 & -0.126132 & -0.012747 & 0.000677 & 0.013779 & 1.005783 \\
    \textbf{TATACONSUM.NS} & 1382.0 & 0.001106 & 0.020113 & -0.142695 & -0.008766 & 0.000595 & 0.010618 & 0.112829 \\
    \textbf{BAJFINANCE.NS} & 1382.0 & 0.001330 & 0.024859 & -0.232308 & -0.009948 & 0.000933 & 0.012339 & 0.109655 \\
    \textbf{HCLTECH.NS} & 1382.0 & 0.000994 & 0.017756 & -0.085616 & -0.008416 & 0.001183 & 0.010824 & 0.111755 \\
    \textbf{INFY.NS} & 1382.0 & 0.000982 & 0.017751 & -0.153057 & -0.008284 & 0.001359 & 0.009925 & 0.120334 \\
    \hline
    \end{tabular}
    \caption{Statistics for Stocks}
    \label{tab:statistics_of_returns}
\end{table}
The table \ref{tab:statistics_of_returns} represents the statistical analysis\footnote{The values here are in absolute terms.} of daily returns for ten different stocks over a period of 1382 observations. It is observed that
\begin{enumerate}
    \item The stock with the daily mean return is ADANIENT.NS at 0.03056, while NESTLE.NS is the lowest at 0.00967.
    \item In terms of volatility, TATASTEEL.NS has the highest standard deviation (0.036514), indicating the highest risk, while NESTLEIND.NS is the least volatile stock with the least standard deviation (0.014899).
    \item Highest single-day loss is registered by ADANIENT.NS (-0.281970), while the highest single-day gain is recorded by TATASTEEL.NS (1.005783).
    \item The wide difference between minimum and maximum returns for some stocks, including TATASTEEL.NS and BAJFINANCE.NS, reveals the presence of outliers, indicating anomalous daily returns.
    \item The stock with the greatest median return is INFY.NS, suggesting it typically had better daily returns compared to the others.
\end{enumerate}
The daily return data were utilized as input for the mean-variance model. The model assumes that a trading year comprises 252 days, and a historical dataset spanning 10 years is employed for analysis.
\begin{figure}[h]
    \centering
    \includegraphics[width=0.72\textwidth]{Methodology/newplot(5).png}
    \caption{Optimal investment}
    \label{fig:optimal_investment}
\end{figure}
\newline
The optimal portfolio shown in figure \ref{fig:optimal_investment} has the following statistics: a) \textbf{\small{Sharpe Ratio}}: 1.4653, b) \textbf{\small{Expected return}}: 0.4257, c) \textbf{\small{Volatility}}: 0.2827 \\\\
The table \ref{tab:capital_allocation} showcases the optimal capital allocation for various stocks generated by a mean-variance optimisation model. This model accounts for the expected return (mean) and the volatility (variance) to optimise the portfolio. The allocations are proportional to the expected return and inversely proportional to the risk.
\begin{table}[h]
    \centering
    \begin{tabular}{|l|r|}
    \hline
    \textbf{Stock} & \textbf{Capital Allocation} \\
    \hline
    \textbf{ADANIENT.NS} & 0.2827 \\
    \textbf{APOLLOHOSP.NS} & 0.1495 \\
    \textbf{NESTLEIND.NS} & 0.2110 \\
    \textbf{TITAN.NS} & 0.0937 \\
    \textbf{DIVISLAB.NS} & 0.0848 \\
    \textbf{TATASTEEL.NS} & 0.0546 \\
    \textbf{TATACONSUM.NS} & 0.0000 \\
    \textbf{BAJFINANCE.NS} & 0.0000 \\
    \textbf{HCLTECH.NS} & 0.0481 \\
    \textbf{INFY.NS} & 0.0755 \\
    \hline
    \end{tabular}
    \caption{Optimal Capital Allocation}
    \label{tab:capital_allocation}
\end{table}
\newline
The largest capital allocation is awarded to ADANIENT.NS (28.27\%), which could be due to its considerable returns in the past three years\footnote{The period between June 2020 and July 2023}, witnessing a tremendous growth of over 1000\%. On the other hand, TATACONSUM.NS and BAJFINANCE.NS have zero allocation due to relatively lower returns or higher risk levels.
