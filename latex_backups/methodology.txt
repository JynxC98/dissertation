\addcontentsline{toc}{chapter}{Methodology}
\chapter*{\hfill Methodology}
\addcontentsline{toc}{section}{Data Collection}
\section*{\large{Data Collection}}
\begin{enumerate}
    \item \textbf{Data Source}: The historical data of 10 years for this dissertation was collected using the Yahoo Finance API(\href{https://python-yahoofinance.readthedocs.io/en/latest/api.html}{yfinance}), specifically version 0.2.18. This API allowed for retrieving the financial data relevant to the dissertation objectives.
    \item \textbf{Code Language}: The coding language employed throughout the study is Python (version 3.8). Python provided a robust and versatile platform for conducting research and data analysis.
    \item \textbf{Data Analysis and Statistical measurements}: For statistical analysis, \href{https://numpy.org/doc/}{Numpy}(version 1.20.3) and \href{https://pandas.pydata.org/docs/}{Pandas}(version 1.5.3) were used. These libraries offered comprehensive functionalities for data manipulation and statistical computations.
    \item \textbf{Exploratory Data Analysis(EDA)}: \href{https://plotly.com/python/}{Plotly}(version 5.13.0) and Tableau\footnote{Tableau's student version was used, and access to this version was obtained by verifying and substantiating my student status as required by the provider.} were extensively used to generate plots and visualisations. 
    \item \textbf{Optimisation}: Scipy's \href{https://docs.scipy.org/doc/scipy/reference/optimize.html}{optimisation}\footnote{The \href{SLSPQ}{SLSPQ} algorithm, provided within the optimisation function of the Scipy library, was employed in this study.}(version 1.5.4),  was used to conduct the convex optimisation for the baseline mean-variance model. 
    \item \textbf{Machine Learning}: For the deployment of ML algorithms, the study will employ \href{https://scikit-learn.org/stable/}{Scikit-learn} library(version 0.23.2). Scikit-learn is widely used by ML practitioners as it provides a comprehensive set of tools for training, evaluating, and deploying ML models.
\end{enumerate}
These tools and libraries were carefully selected based on their suitability, reliability, and compatibility with the research objectives and methodologies. Their usage adhered to the terms and conditions of their respective licenses and complied with relevant legal and ethical guidelines.
\newpage
\addcontentsline{toc}{section}{Stock selection}
\section*{\large{Stock Selection}}
Here is the overall schematic of the initial stock selection process:
\begin{figure}[h]
\centering
\begin{tikzpicture}[scale=0.7, every node/.style={scale=0.7}, node distance=2cm]
\usetikzlibrary{shapes.geometric, arrows}
\node (start) [rectangle, rounded corners, text centered, draw=black] {Start};
\node (selectindex) [rectangle, text centered, draw=black, below of=start] {Select the Market Index};
\node (selectstocks) [rectangle, text centered, draw=black, below of=selectindex] {Select the Pool of Stocks};
\node (calculateKPI) [rectangle, text centered, draw=black, below of=selectstocks] {Calculate KPI};
\node (decision) [diamond, aspect=2, text centered, draw=black, below of=calculateKPI] {KPI $>$ Threshold?};
\node (feedmodel) [rectangle, text centered, draw=black, below of=decision, yshift=-1cm] {Feed Model to Optimizer};
\node (results) [rectangle, rounded corners, text centered, draw=black, below of=feedmodel] {Generate Optimal Weights and Calculate Returns};

\draw [->] (start) -- (selectindex);
\draw [->] (selectindex) -- (selectstocks);
\draw [->] (selectstocks) -- (calculateKPI);
\draw [->] (calculateKPI) -- (decision);
\draw [->] (decision) -- node [midway, right] {Yes} (feedmodel);
\draw [->] (feedmodel) -- (results);
\draw [->] (decision) -| node [midway, above] {No} ++(-3cm,0) |- (selectstocks);
\end{tikzpicture}
\caption{The initial stock selection process.}
\end{figure} 
\newline
The dissertation's data is acquired from \href{https://www.nseindia.com/}{National Stock Exchange(NSE)}, an Indian stock exchange. The National Stock Exchange is one of the distinguished stock exchanges in India and plays a crucial role in the Indian financial market. Established in 1992, the NSE has emerged as a leading platform for trading several financial instruments, including derivatives, equities, currencies, debt securities, etc. As of 19th June 2023, NSE had over 1,600 actively traded stocks listed on its platform. These stocks represent various sectors and industries, providing investors with myriad investment opportunities. We will be using \href{https://www.nseindia.com/market-data/live-equity-market}{NIFTY 50} for our study. \\\\
This study employs the usage of \href{https://algotrading101.com/learn/yahoo-finance-api-guide/}{Yahoo Finance API} to gather the data from the NIFTY 50 index. The historical data of 10 years is fed into Markowitz's mean-variance model. The historical returns are used to rank the stocks based on the weighted average of Sharpe (\cite{sharpe1964capital}) and Sortino (\cite{sortino1994downside}) ratios, with more weight assigned to the former. The Sortino ratio is defined by
\begin{align}
    S_o = \frac{\mathbb{E}\left[R_p - r_f\right]}{\sigma_d}
\end{align}
where, \\
$S_o$: Sortino Ratio \\
$R_p$: Portfolio return \\
$r_f$: Risk free return \\
$\sigma_d$: Standard deviation of downside \\\\
The KPI used to evaluate stock performance:
\begin{align}
    \label{eq:KPI}
    \text{KPI} = 0.7\times \text{Sharpe Ratio} + 0.3\times \text{Sortino Ratio}
\end{align}
The study utilises the KPI for the initial stock selection process.
\addcontentsline{toc}{section}{Key findings and figures}
\section*{\large{Key findings and figures}}
Let $S_i$ and $r_{i}$ be the stock price and its return at time $i$ respectively. Let $R$ be the total return on the stock and $T$ be the time horizon. The cumulative return is given by
\begin{align}
    \label{eq:cumulative_return}
    R = \prod_{i=1}^T (1 + r_i)
\end{align}
For this dissertation, percentage return is used.
\begin{align}
    \label{eq:percentage_return}
    r = \frac{p_t - p_{t-1}}{p_{t-1}}
\end{align}
where, \\
$p_t$: Stock price in the current period \\
$p_{t-1}$: Previous stock price
\begin{figure}[h]
    \centering
    \includegraphics[width=0.9\textwidth]{Methodology/newplot(1).png}
    \caption{Cumulative returns in the span of 10 years.}
    \label{fig:image}
\end{figure}
\begin{table}[h]
    \centering
\begin{tabular}{|l|r|}
\hline
\textbf{Stock} & \textbf{Growth} \\
\hline
BAJFINANCE.NS & 52.884323 \\
BRITANNIA.NS & 18.045825 \\
ADANIENT.NS & 89.707355 \\
BAJAJFINSV.NS & 24.048048 \\
TITAN.NS & 13.830394 \\
JSWSTEEL.NS & 14.249522 \\
EICHERMOT.NS & 11.954589 \\
ASIANPAINT.NS & 7.898897 \\
TATASTEEL.NS & 12.474015 \\
HCLTECH.NS & 7.601352 \\
\hline
\end{tabular}
    \caption{Stock Growth in the span of 10 years}
    \label{tab:stock_growth}
\end{table}
\newpage
\noindent
The table \ref{tab:top_10_stocks} displayes the values of Sharpe Ratio, Sortino Ratio and the corresponding KPI values.
\begin{table}[h]
\centering
\begin{tabular}{|l|r|r|r|}
\hline
\textbf{Ticker} & \textbf{Sharpe Ratio} & \textbf{Sortino Ratio} & \textbf{KPI} \\
\hline
BAJFINANCE.NS  & 1.079519     & 1.819494      & 1.301512 \\
BRITANNIA.NS   & 0.997274     & 1.791131      & 1.235431 \\
ADANIENT.NS    & 0.989250     & 1.625787      & 1.180211 \\
BAJAJFINSV.NS  & 0.921565     & 1.558132      & 1.112535 \\
TITAN.NS       & 0.779165     & 1.364510      & 0.954769 \\
JSWSTEEL.NS    & 0.743176     & 1.247523      & 0.894480 \\
EICHERMOT.NS   & 0.720085     & 1.285268      & 0.889640 \\
ASIANPAINT.NS  & 0.665725     & 1.136649      & 0.807002 \\
TATASTEEL.NS   & 0.586575     & 1.305080      & 0.802127 \\
HCLTECH.NS     & 0.633753     & 1.047578      & 0.757900  \\
\hline
\end{tabular}
    \caption{Top 10 stocks based on KPI}
    \label{tab:top_10_stocks}
\end{table}
\begin{table}[h]
\centering
\small
\begin{tabular}{|l|c|c|c|c|c|c|c|c|}
\hline
\textbf{Ticker}          & \textbf{Count} & \textbf{Mean}     & \textbf{Std}      & \textbf{Min}       & \textbf{25\%}      & \textbf{50\%}      & \textbf{75\%}      & \textbf{Max}       \\ \hline
BAJFINANCE.NS   & 2464  & 0.001896 & 0.023801 & -0.232308 & -0.009366 & 0.000948  & 0.012951  & 0.110052  \\
BRITANNIA.NS    & 2464  & 0.001309 & 0.016416 & -0.133702 & -0.007145 & 0.000410  & 0.009227  & 0.106639  \\
ADANIENT.NS     & 2464  & 0.002438 & 0.034667 & -0.387493 & -0.012438 & 0.001833  & 0.016773  & 0.273680  \\
BAJAJFINSV.NS   & 2464  & 0.001524 & 0.021466 & -0.258621 & -0.009593 & 0.000596  & 0.011721  & 0.114534  \\
TITAN.NS        & 2464  & 0.001269 & 0.020205 & -0.122560 & -0.008970 & 0.000715  & 0.010510  & 0.187874  \\
JSWSTEEL.NS     & 2464  & 0.001334 & 0.022572 & -0.178378 & -0.011301 & 0.001115  & 0.013703  & 0.123667  \\
EICHERMOT.NS    & 2464  & 0.001224 & 0.020863 & -0.125813 & -0.010493 & 0.000246  & 0.011677  & 0.133801  \\
ASIANPAINT.NS   & 2464  & 0.000979 & 0.016723 & -0.140279 & -0.007907 & 0.000531  & 0.009783  & 0.088527  \\
TATASTEEL.NS    & 2464  & 0.001439 & 0.031444 & -0.131296 & -0.012762 & 0.000586  & 0.013864  & 1.005783  \\
HCLTECH.NS      & 2464  & 0.000977 & 0.017523 & -0.127374 & -0.008624 & 0.001195  & 0.010542  & 0.111754  \\ \hline
\end{tabular}
    \caption{Statistics for Stocks}
    \label{tab:statistics_of_returns}
\end{table}
\newline
The table \ref{tab:statistics_of_returns} represents the statistical analysis\footnote{The values here are in absolute terms.} of daily returns for ten different stocks over a period of 2464 observations. It is observed that
\begin{enumerate}
    \item The stock with highest daily mean return is ADANIENT.NS at 0.02438, while HCLTECH.NS is the lowest at 0.00967.
    \item In terms of volatility, ADANIENT.NS has the highest standard deviation (0.034667), indicating the highest risk, while BRITANNIA.NS is the least volatile stock with the least standard deviation (0.016416).
    \item The stock ADANIENT.NS registered the highest single-day loss (-0.387493), while TATASTEEL.NS recorded the highest single-day gain (1.005783).
    \item The wide difference between minimum and maximum returns for some stocks, including TATASTEEL.NS and BAJFINANCE.NS, reveals the presence of outliers, indicating anomalous daily returns.
    \item The stock with the greatest median return is ADANIENT.NS, suggesting it typically had better daily returns compared to the others.
\end{enumerate}
The mean-variance model was fed with the daily return data, considering a trading year of 252 days. The analysis is based on a historical dataset spanning 10 years.
\begin{figure}[h]
    \centering
    \includegraphics[width=0.72\textwidth]{Methodology/newplot(6).png}
    \caption{Optimal investment}
    \label{fig:optimal_investment}
\end{figure}
\newpage
\noindent
The optimal portfolio\footnote{The risk-free rate of 7\% is assumed to be constant throughout the time period} shown in figure \ref{fig:optimal_investment} has the following statistics: a) \textbf{\small{Sharpe Ratio}}: 1.499, b) \textbf{\small{Expected return}}: 0.3892, c) \textbf{\small{Volatility}}: 0.2128 \\\\
The table \ref{tab:capital_allocation} showcases the optimal capital allocation for various stocks generated by a mean-variance optimisation model. This model accounts for the expected return (mean) and the volatility (variance) to optimise the portfolio. The allocations are proportional to the expected return and inversely proportional to the risk.
\begin{table}[h]
    \centering
    \begin{tabular}{|l|r|}
    \hline
    \textbf{Stock} & \textbf{Capital Allocation} \\
    \hline
    BAJFINANCE.NS & 0.2095 \\
    BRITANNIA.NS & 0.3123 \\
    ADANIENT.NS & 0.1452 \\
    BAJAJFINSV.NS & 0.0121 \\
    TITAN.NS & 0.1047 \\
    JSWSTEEL.NS & 0.0000 \\
    EICHERMOT.NS & 0.0300 \\
    ASIANPAINT.NS & 0.0033 \\
    TATASTEEL.NS & 0.0318 \\
    HCLTECH.NS & 0.1511 \\
    \hline
    \end{tabular}
    \caption{Optimal Capital Allocation}
    \label{tab:capital_allocation}
\end{table}


\begin{center}
\begin{figure}
\centering
\begin{tikzpicture}[
  node distance = 2cm,
  auto,
  block/.style = {rectangle, draw, align=center, minimum width=3cm, minimum height=1cm},
  decision/.style = {diamond, draw, align=center},
  line/.style = {draw, -latex}
]

\node [block] (start) {Start};
\node [block, below of=start] (index) {Select the Market Index};
\node [block, below of=index] (pool) {Select the pool of stocks};
\node [block, below left= of pool, node distance=4cm] (sharpe) {Select top 10 stocks based on \\ Sharpe Ratio};
\node [block, below right= of pool, node distance=4cm] (sortino) {Select top 10 stocks based on \\ Sortino Ratio};
\node [block, below of=pool] (intersect) {Common Stocks};
\node [block, below of=intersect] (data) {Feed the data into mean-variance model};
\node [block, below of=data] (weights) {Generate optimal weights};

\path [line] (start) -- (index);
\path [line] (index) -- (pool);
\path [line] (pool.west) -| (sharpe.north);
\path [line] (pool.east) -| (sortino.north);
\path [line] (sharpe.east) |- (intersect.west);
\path [line] (sortino.west) |- (intersect.east);
\path [line] (intersect) -- (data);
\path [line] (data) -- (weights);

\end{tikzpicture}
\caption{Flowchart}
\label{fig:flowchart}
\end{figure}
\end{center}